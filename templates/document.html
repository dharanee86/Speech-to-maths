{% extends "base.html" %}
{% load static %}

{% block title %} {{ doc.titre }} {% endblock %}
{% block head %} {% endblock %}
{% block nav %} {% endblock %}
{% block content %} 
<div class = "top-bar">
	<a href = "{% url "documents" %}">
		<h3> 
			<i class="fa fa-list" aria-hidden="true"> </i> &nbsp;
			Documents 
		</h3>
	</a>
	<input type = "text" name = "titre" value = "{{ doc.title }}" form = "enregistrement">
	<span class = "to-the-right">
	
		<i id = "communication_indicator" class="fa fa-spinner fa-spin" aria-hidden="true" style = "display : none"></i>
	
		<button id = "start_rec" onclick = "manageRecording(voiceAnalysisLink, audioResponseManager);">
			<i class="fa fa-volume-up" aria-hidden="true"></i> &nbsp;
			Commencer la dictée
		</button>
	
		<button  id = "stop_rec" style = "display : none">
			<i class="fa fa-volume-up blinking-icon" aria-hidden="true"></i> &nbsp;
			Arrêter la dictée
		</button>
		&nbsp;

	</span>
</div>	

<div class = "top-bar-filler"> 
	<button type="submit"> 
			<i class="fa fa-file-o" aria-hidden="true"></i> &nbsp;
	</button>
</div>

<div
 class = "tool-bar"> 
	<div class = "text-editor-button-group">
		<button class = "text-editor-button" id = "moveBackward" title = "Aller en arrière (Ctrl + Z)" onclick="contentStateManager.moveBackward();manageQueueButtonsStyle();"><i class="fa fa-undo" aria-hidden="true"></i></button><!--
	 --><button class = "text-editor-button" id = "moveForward" title = "Aller en avant (Ctrl + Y)" onclick="contentStateManager.moveForward();manageQueueButtonsStyle();"><i class="fa fa-repeat" aria-hidden="true"></i></button>
	</div><!--
 --><div class = "text-editor-button-group" preview('divtext', 'divmat', 'textArea')>
		<button class = "text-editor-button" title = "Aligner à gauche (Ctrl + L)" onclick="addEnvironnement('flushleft');"><i class="fa fa-align-left" aria-hidden="true"></i></button><!--
	 --><button class = "text-editor-button" title = "Aligner au centre (Ctrl + E)" onclick="addEnvironnement('center');"><i class="fa fa-align-center" aria-hidden="true"></i></button><!--
	 --><button class = "text-editor-button" title = "Aligner à droite (Ctrl + R)" onclick="addEnvironnement('flushright');"><i class="fa fa-align-right" aria-hidden="true"></i></button><!--
	 --><button class = "text-editor-button" title = "Justifier le texte (Ctrl + J)" onclick="addEnvironnement('work in progress');"><i class="fa fa-align-justify" aria-hidden="true"></i></button>
   </div><!--
 --><div class = "text-editor-button-group">
		<button class = "text-editor-button" title = "Exposant (Ctrl + ↑)" onclick="sciptElement('exponent');"><i class="fa fa-superscript" aria-hidden="true"></i></button><!--
	 --><button class = "text-editor-button" title = "Indice (Ctrl + ↓)" onclick="sciptElement('subscript');"><i class="fa fa-subscript" aria-hidden="true"></i></button>
	</div><!--
 --><div class = "text-editor-button-group">
		<button class = "text-editor-button" title = "Liste (puces)" onclick="listButton('unordered');"><i class="fa fa-list-ul" aria-hidden="true"></i></button><!--
	 --><button class = "text-editor-button" title = "Liste (ordonnée)" onclick="listButton('ordered');"><i class="fa fa-list-ol" aria-hidden="true"></i></button>
   </div><!--
 --><div class = "text-editor-button-group">
		<button class = "text-editor-button" title = "Insérer un tableau"><i class="fa fa-table" aria-hidden="true"></i></button>
	</div>	
</div>

<div class = "doc-content">

	<div class = "text-container" id="divtext" style="display:block">
		<textarea name = "content" id="textArea" autofocus oninput = "setTimeout(manageContentChange, 0)" onblur="preview('divtext', 'divmat', 'textArea')">{{ doc.content }}</textarea>
	</div>

	<div class = "text-container"  id="divmat" title = "Cliquez pour modifier" onclick="preview('divtext', 'divmat', 'textArea')" style="display:none; height: 76vh">

	</div>

</div>

{% if doc.pdf %}
<div class = "doc-content">
	<h3> PDF </h3>
	<iframe src="{{ doc.pdf.url }}" width="1200" height="600" align="middle"></iframe>
</div>
{% endif %}

{% csrf_token %}

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js">
MathJax.Hub.Config({
  config: ["MMLorHTML.js"],
  jax: ["input/TeX","input/MathML","input/AsciiMath","output/HTML-CSS","output/NativeMML"],
  extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js"],
  tex2jax: {
  	inlineMath: [['$','$']],
  	balanceBraces: true,
  	processEnvironments: true,
  	multiLine: true,
  	preview: "TeX",
	},
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"],
    noErrors: {
    	inlineDelimiters: ["$","$"],
    	multiLine: false,
    	style: {
      	"font-size": "normal",
      	"border": "",
      	"align":  "left",
    	}
    },
  }
});
</script>

<script> 
	var voiceAnalysisLink = "{% url 'voice_analysis' %}";
	var documentSaveLink = "{% url 'save_document' %}"
	var docID = {{ doc.id }};
	var textContent = "blabla";
</script>
<script src = "{% static 'js/communicationIndicatorManager.js' %}"> </script>
<script src = "{% static 'js/document/contentStateManager.js' %}"> </script>
<script src = "{% static 'js/document/contentModification.js' %}"> </script>
<script src = "{% static 'js/document/general.js' %}"> </script>
<script src = "{% static 'js/manageRecording.js' %}"> </script>
{% endblock %}